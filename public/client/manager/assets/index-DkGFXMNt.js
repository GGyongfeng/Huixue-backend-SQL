var e=(e,a,t)=>new Promise(((s,l)=>{var o=e=>{try{i(t.next(e))}catch(a){l(a)}},r=e=>{try{i(t.throw(e))}catch(a){l(a)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);i((t=t.apply(e,a)).next())}));import{_ as a,n as t,o as s,l,H as o,p as r,g as i}from"./index-BUNx4JnC.js";import{t as n,U as u,a6 as d,r as c,f as g,c as h,v,x as p,A as f,H as m,u as y,y as x,F as w,a2 as b,O as k,at as _,w as I,L as B,h as M,ai as P,J as S}from"./vue-vendor-DLFc8NEb.js";import{_ as V,a as L}from"./lf_icon-CVxtErHg.js";import{b as T}from"./other-vendor-BLeOv60h.js";import{E as z,y as U,b as C,G as F,B as X}from"./element-plus-Df8vcUUO.js";const j=["innerHTML"],H=a(n({__name:"DragVerify",props:{value:{type:Boolean,default:!1},width:{default:260},height:{default:44},text:{default:"按住滑块拖动"},successText:{default:"success"},background:{default:"#eee"},progressBarBg:{default:"#1385FF"},completedBg:{default:"#57D187"},circle:{type:Boolean,default:!1},radius:{default:"6px"},handlerIcon:{default:"&#xea50;"},successIcon:{default:"&#xe621;"},handlerBg:{default:"#fff"},textSize:{default:"13px"},textColor:{default:"#333"}},emits:["handlerMove","update:value","passCallback"],setup(e,{expose:a,emit:t}){const s=t,l=e,o=u({isMoving:!1,x:0,isOk:!1}),{isOk:r}=d(o),i=c(),n=c(),_=c(),I=c();g((()=>{var e,a,t;null==(e=i.value)||e.style.setProperty("--textColor",l.textColor),null==(a=i.value)||a.style.setProperty("--width",Math.floor(l.width/2)+"px"),null==(t=i.value)||t.style.setProperty("--pwidth",-Math.floor(l.width/2)+"px")}));const B={left:"0",width:l.height+"px",height:l.height+"px",background:l.handlerBg},M={width:l.width+"px",height:l.height+"px",lineHeight:l.height+"px",background:l.background,borderRadius:l.circle?l.height/2+"px":l.radius},P={background:l.progressBarBg,height:l.height+"px",borderRadius:l.circle?l.height/2+"px 0 0 "+l.height/2+"px":l.radius},S={height:l.height+"px",width:l.width+"px",fontSize:l.textSize},V=h((()=>l.value?l.successText:l.text)),L=e=>{l.value||(o.isMoving=!0,_.value.style.transition="none",o.x=(e.pageX||e.touches[0].pageX)-parseInt(_.value.style.left.replace("px",""),10)),s("handlerMove")},T=e=>{if(o.isMoving&&!l.value){let a=(e.pageX||e.touches[0].pageX)-o.x;a>0&&a<=l.width-l.height?(_.value.style.left=a+"px",I.value.style.width=a+l.height/2+"px"):a>l.width-l.height&&(_.value.style.left=l.width-l.height+"px",I.value.style.width=l.width-l.height/2+"px",U())}},z=e=>{if(o.isMoving&&!l.value){(e.pageX||e.changedTouches[0].pageX)-o.x<l.width-l.height?(o.isOk=!0,_.value.style.left="0",_.value.style.transition="all 0.2s",I.value.style.width="0",o.isOk=!1):(_.value.style.transition="none",_.value.style.left=l.width-l.height+"px",I.value.style.width=l.width-l.height/2+"px",U()),o.isMoving=!1}},U=()=>{s("update:value",!0),o.isMoving=!1,I.value.style.background=l.completedBg,n.value.style["-webkit-text-fill-color"]="unset",n.value.style.animation="slidetounlock2 3s infinite",n.value.style.color="#fff",s("passCallback")};return a({reset:()=>{_.value.style.left="0",I.value.valueFormat.style.width="0",_.value.children[0].type=l.handlerIcon,n.value.style["-webkit-text-fill-color"]="transparent",n.value.style.animation="slidetounlock 3s infinite",n.value.style.color=l.background}}),(e,a)=>(v(),p("div",{ref_key:"dragVerify",ref:i,class:"drag_verify",style:M,onMousemove:T,onMouseup:z,onMouseleave:z,onTouchmove:T,onTouchend:z},[f("div",{class:m(["dv_progress_bar",{goFirst2:y(r)}]),ref_key:"progressBar",ref:I,style:P},null,2),f("div",{class:"dv_text",style:S,ref_key:"messageRef",ref:n},[e.$slots.textBefore?x(e.$slots,"textBefore",{key:0},void 0,!0):w("",!0),b(" "+k(V.value)+" ",1),e.$slots.textAfter?x(e.$slots,"textAfter",{key:1},void 0,!0):w("",!0)],512),f("div",{class:m(["dv_handler dv_handler_bg",{goFirst:y(r)}]),onMousedown:L,onTouchstart:L,ref_key:"handler",ref:_,style:B},[f("i",{class:"iconfont-sys",innerHTML:e.value?e.successIcon:e.handlerIcon},null,8,j)],34)],544))}}),[["__scopeId","data-v-b06b39b6"]]);var O=(e=>(e[e.success=200]="success",e))(O||{});class ${static login(a){return e(this,null,(function*(){var e;try{const s=yield t.post({url:"/api/manager/users/login",data:a});return 200===s.code&&(null==(e=s.data)||e.token),s}catch(s){throw s}}))}}const A={class:"login"},R={class:"left-wrap"},D={class:"logo"},E={class:"title"},G={class:"right-wrap"},J={class:"header"},K={class:"login-wrap"},q={class:"form"},N={class:"input-wrap"},Q={key:0,class:"input-label"},W={class:"input-wrap"},Y={key:0,class:"input-label"},Z={class:"drag-verify"},ee={class:"forget-password"},ae={style:{"margin-top":"30px"}},te=a(n({__name:"index",setup(a){const t=s(),n=_(),u=c(!1),d=c(!1),g=c(!1),h=l.name,x=c(localStorage.getItem("lastLoginUsername")||""),j=c("true"===localStorage.getItem("rememberPassword")&&localStorage.getItem("lastLoginPassword")||""),te=c(!1),se=c("true"===localStorage.getItem("rememberPassword")),{width:le}=T(),oe=()=>{},re=()=>e(this,null,(function*(){if(!x.value)return void z.error("请输入账号");if(!j.value)return void z.error("请输入密码");if(!u.value)return void(d.value=!0);te.value=!0;const e={username:x.value,password:j.value};try{const a=yield $.login(e);if(a.code===O.success){localStorage.setItem("lastLoginUsername",x.value),se.value?(localStorage.setItem("lastLoginPassword",j.value),localStorage.setItem("rememberPassword","true")):(localStorage.removeItem("lastLoginPassword"),localStorage.setItem("rememberPassword","false"));const e=a.data;t.setUserInfo(e),t.setLoginStatus(!0),ie(),n.push(o)}else z.error(a.message||"登录失败")}catch(a){z.error("网络错误，请检查服务器连接")}finally{te.value=!1}}));I(se,(e=>{e?(localStorage.setItem("rememberPassword","true"),j.value&&localStorage.setItem("lastLoginPassword",j.value)):(localStorage.removeItem("lastLoginPassword"),localStorage.setItem("rememberPassword","false"))}));const ie=()=>{setTimeout((()=>{U({title:r(),type:"success",showClose:!1,duration:3e3,message:`欢迎登录 ${h}`})}),300)};return(e,a)=>{const t=C,s=H,l=F,o=X;return v(),p("div",A,[f("div",R,[f("div",D,[a[4]||(a[4]=f("svg",{class:"icon","aria-hidden":"true"},[f("use",{"xlink:href":"#icon-zhaopian-copy"})],-1)),f("h1",E,k(y(h)),1)]),a[5]||(a[5]=f("img",{class:"left-bg",src:V},null,-1)),a[6]||(a[6]=f("img",{class:"left-img",src:L},null,-1))]),f("div",G,[f("div",J,[a[7]||(a[7]=f("svg",{class:"icon","aria-hidden":"true"},[f("use",{"xlink:href":"#icon-zhaopian-copy"})],-1)),f("h1",null,k(y(h)),1)]),f("div",K,[f("div",q,[a[10]||(a[10]=f("h3",{class:"title"},"欢迎回来",-1)),a[11]||(a[11]=f("p",{class:"sub-title"},"输入您的账号和密码登录",-1)),f("div",N,[y(g)?(v(),p("span",Q,"账号")):w("",!0),B(t,{placeholder:"请输入账号",size:"large",modelValue:y(x),"onUpdate:modelValue":a[0]||(a[0]=e=>M(x)?x.value=e:null),modelModifiers:{trim:!0}},null,8,["modelValue"])]),f("div",W,[y(g)?(v(),p("span",Y,"密码")):w("",!0),B(t,{placeholder:"请输入密码",size:"large",modelValue:y(j),"onUpdate:modelValue":a[1]||(a[1]=e=>M(j)?j.value=e:null),modelModifiers:{trim:!0},type:"password",radius:"8px",autocomplete:"off",onKeyup:P(re,["enter"])},null,8,["modelValue"])]),f("div",Z,[f("div",{class:m(["drag-verify-content",{error:!y(u)&&y(d)}])},[B(s,{ref:"dragVerify",value:y(u),"onUpdate:value":a[2]||(a[2]=e=>M(u)?u.value=e:null),width:y(le)<500?328:438,radius:"8px",text:"按住滑块拖动",successText:"验证成功",progressBarBg:y(i)("--el-color-primary"),onPass:oe},null,8,["value","width","progressBarBg"])],2),f("p",{class:m(["error-text",{"show-error-text":!y(u)&&y(d)}])},"请拖动滑块完成验证",2)]),f("div",ee,[B(l,{modelValue:y(se),"onUpdate:modelValue":a[3]||(a[3]=e=>M(se)?se.value=e:null)},{default:S((()=>a[8]||(a[8]=[b("记住密码")]))),_:1},8,["modelValue"])]),f("div",ae,[B(o,{class:"login-btn",size:"large",type:"primary",onClick:re,loading:y(te)},{default:S((()=>a[9]||(a[9]=[b(" 登录 ")]))),_:1},8,["loading"])])])])])])}}}),[["__scopeId","data-v-b25803d8"]]);export{te as default};
